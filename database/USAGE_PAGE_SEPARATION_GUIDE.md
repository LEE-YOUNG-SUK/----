# 📦 판매/사용 페이지 분리 완료 가이드

## ✅ 작업 완료 내역

### 변경 전 (탭 방식)
```
/sales
├── [판매 탭]
└── [사용 탭]
```

### 변경 후 (별도 페이지)
```
/sales   → 💰 판매 관리 (고객 판매, 이익 계산)
/usage   → 📦 사용 관리 (내부소모, 재료비)
```

---

## 🎯 수정된 파일

### 1. 판매 페이지 수정
**파일: `app/sales/page.tsx`**
- ✅ 탭 관련 코드 제거
- ✅ `transactionType="SALE"` 고정
- ✅ `SalesPageClient` 제거, 직접 `SaleForm` 렌더링
- ✅ 페이지 타이틀: "💰 판매 관리"
- ✅ 설명: "화장품 등 고객에게 판매하고 이익을 계산합니다"

### 2. 사용 페이지 생성
**파일: `app/usage/page.tsx` (신규)**
- ✅ 판매 페이지와 동일한 구조
- ✅ `transactionType="USAGE"` 고정
- ✅ `getSalesHistory`에 `'USAGE'` 필터 전달
- ✅ 페이지 타이틀: "📦 사용 관리 (내부소모)"
- ✅ 설명: "의료 소모품 등 내부 사용. 출고 단가는 입고 원가(FIFO)로 자동 적용됩니다"

### 3. 네비게이션 메뉴 추가
**파일: `components/shared/Navigation.tsx`**
- ✅ 메뉴 항목 추가: `/usage` - "📦 사용"
- ✅ 순서: 대시보드 → 품목 → 입고 → 판매 → **사용** → 재고
- ✅ 아이콘 조정:
  - 판매: `📤` → `💰`
  - 사용: `📦` (신규)
  - 재고: `📦` → `📊`

### 4. 권한 설정 추가
**파일: `types/permissions.ts`**
- ✅ `PermissionResource`에 `'usage_management'` 추가
- ✅ 모든 역할에 `usage_management` 권한 부여:
  - **시스템 관리자 (0000)**: CRUD 전체
  - **원장 (0001)**: CRUD 전체
  - **매니저 (0002)**: CRUD 전체
  - **사용자 (0003)**: CRU (삭제 불가)

### 5. 불필요한 파일 삭제
- ✅ `components/sales/SalesPageClient.tsx` 삭제 (탭 컴포넌트 더 이상 불필요)

---

## 📋 페이지 비교

| 항목 | `/sales` (판매) | `/usage` (사용) |
|------|----------------|----------------|
| **목적** | 고객에게 판매 | 내부 소모 |
| **아이콘** | 💰 | 📦 |
| **고객** | 선택 필수 (일반 고객) | "내부사용" 자동 (고정) |
| **단가** | 사용자 입력 (편집 가능) | FIFO 원가 자동 (읽기 전용) |
| **이익** | 계산됨 (판매가 - 원가) | 0 (항상) |
| **거래유형** | `transaction_type: 'SALE'` | `transaction_type: 'USAGE'` |
| **히스토리** | SALE 건만 표시 | USAGE 건만 표시 |

---

## 🚀 네비게이션 구조

### 메인 메뉴
```
┌─────────────────────────────────────┐
│ 📊 대시보드                         │
│ 📋 품목                             │
│ 📥 입고                             │
│ 💰 판매        ← 고객 판매         │
│ 📦 사용        ← 내부소모 (신규!)  │
│ 📊 재고                             │
└─────────────────────────────────────┘
```

---

## 🔐 권한 매트릭스

| 역할 | 판매 (CRUD) | 사용 (CRUD) |
|------|-------------|-------------|
| 시스템 관리자 (0000) | ✅✅✅✅ | ✅✅✅✅ |
| 원장 (0001) | ✅✅✅✅ | ✅✅✅✅ |
| 매니저 (0002) | ✅✅✅✅ | ✅✅✅✅ |
| 사용자 (0003) | ✅✅✅❌ | ✅✅✅❌ |

> 💡 사용자(0003)는 판매와 사용 모두 **삭제(Delete) 불가**

---

## 💾 데이터베이스

### 변경 사항 없음
- ✅ 기존 `sales` 테이블 그대로 사용
- ✅ `transaction_type` 컬럼으로 구분
- ✅ `database/add_transaction_type.sql` 이미 적용됨
- ✅ `database/add_transaction_type_to_rpc.sql` 이미 적용됨

---

## 🧪 테스트 시나리오

### 1. 네비게이션 테스트
- [ ] 네비게이션에 "💰 판매", "📦 사용" 메뉴 표시 확인
- [ ] 각 메뉴 클릭 시 올바른 페이지 이동 확인

### 2. 판매 페이지 (/sales)
- [ ] 페이지 타이틀: "💰 판매 관리"
- [ ] 고객 선택 드롭다운 표시
- [ ] 판매단가 입력 가능 (일반 스타일)
- [ ] 저장 시 `transaction_type: 'SALE'` 저장 확인
- [ ] 히스토리에 SALE 건만 표시

### 3. 사용 페이지 (/usage)
- [ ] 페이지 타이틀: "📦 사용 관리 (내부소모)"
- [ ] 고객 "내부사용" 자동 설정 (변경 불가)
- [ ] 출고단가 읽기 전용 (보라색 배경)
- [ ] 저장 시 `transaction_type: 'USAGE'` 저장 확인
- [ ] 히스토리에 USAGE 건만 표시

### 4. 권한 테스트
- [ ] 각 역할별 메뉴 접근 권한 확인
- [ ] 사용자(0003)는 판매/사용 삭제 버튼 숨김 확인

---

## 📊 빌드 결과

```
Route (app)
├ ƒ /sales    ← 판매 페이지
└ ƒ /usage    ← 사용 페이지 (신규!)
```

✅ **빌드 성공!** (TypeScript 에러 없음)

---

## 🎉 기대 효과

1. **명확한 분리**: 판매와 사용이 완전히 별도 페이지로 분리
2. **직관적인 UI**: 각 기능의 목적이 명확
3. **네비게이션 일관성**: 다른 메뉴들과 동일한 레벨
4. **권한 관리 용이**: 페이지별 독립적인 권한 설정
5. **URL 분리**: `/sales`, `/usage`로 명확한 경로

---

## 🔄 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2025-01-26 | 탭 방식으로 판매/사용 구분 추가 |
| 2025-01-26 | 별도 페이지로 분리 및 네비게이션 메뉴 추가 |

---

**작업 완료일**: 2025-01-26  
**빌드 상태**: ✅ 성공  
**DB 변경**: ❌ 없음 (기존 구조 그대로 사용)

