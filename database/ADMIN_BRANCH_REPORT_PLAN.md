# ğŸ“‹ ì‹œìŠ¤í…œ ê´€ë¦¬ì ì „ ì§€ì  ë ˆí¬íŠ¸ ì¡°íšŒ ê³„íš

## ì‘ì„±ì¼: 2025-01-26
## ìƒíƒœ: ê³„íš ìˆ˜ë¦½ ì™„ë£Œ

---

## ğŸ¯ ëª©ì 

ì‹œìŠ¤í…œ ê´€ë¦¬ì(admin, role='0000')ê°€ ë ˆí¬íŠ¸ í˜ì´ì§€ì—ì„œ **ì§€ì ì„ ì„ íƒ**í•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ê°œì„ 

---

## ğŸ“Œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

| ì—­í•  | ì§€ì  ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€ | ì¡°íšŒ ë²”ìœ„ |
|------|---------------------|----------|
| **ì‹œìŠ¤í…œ ê´€ë¦¬ì (0000)** | âœ… ê°€ëŠ¥ | ì „ì²´ ë˜ëŠ” ì„ íƒí•œ ì§€ì  |
| **ì›ì¥ (0001)** | âŒ ë¶ˆê°€ëŠ¥ (ê³ ì •) | ë³¸ì¸ ì§€ì ë§Œ |
| **ë§¤ë‹ˆì € (0002)** | âŒ ë¶ˆê°€ëŠ¥ (ê³ ì •) | ë³¸ì¸ ì§€ì ë§Œ |
| **ì‚¬ìš©ì (0003)** | âŒ ë¶ˆê°€ëŠ¥ (ê³ ì •) | ë³¸ì¸ ì§€ì ë§Œ |

---

## âœ… í˜„ì¬ ìƒíƒœ ë¶„ì„

### ë°ì´í„°ë² ì´ìŠ¤ (ì´ë¯¸ ì§€ì›ë¨)
```sql
-- get_sales_report, get_purchase_report, get_summary_report ë“±
-- ëª¨ë‘ p_branch_id íŒŒë¼ë¯¸í„° ì§€ì›

-- p_branch_id = NULL ë˜ëŠ” '' â†’ ì „ì²´ ì§€ì 
-- p_branch_id = UUID â†’ íŠ¹ì • ì§€ì ë§Œ

WHERE (v_branch_filter = '' OR s.branch_id::TEXT = v_branch_filter)
```

**ê²°ë¡ **: âœ… DB ìˆ˜ì • ë¶ˆí•„ìš”

---

### Server Actions (ì´ë¯¸ ì§€ì›ë¨)
```typescript
// app/reports/sales/actions.ts
const { data, error } = await supabase.rpc('get_sales_report', {
  p_user_role: userRole,
  p_branch_id: filter.branchId || null,  // âœ… ì´ë¯¸ ì „ë‹¬ ì¤‘
  p_start_date: filter.startDate,
  p_end_date: filter.endDate,
  p_group_by: filter.groupBy,
})
```

**ê²°ë¡ **: âœ… Server Actions ìˆ˜ì • ë¶ˆí•„ìš”

---

### í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ (ìˆ˜ì • í•„ìš”)

#### í˜„ì¬ ìƒíƒœ (ë¬¸ì œ)
```tsx
<ReportFilters
  showBranchFilter={userSession.role === '0000'}  // âœ… ì¡°ê±´ë¶€ í‘œì‹œëŠ” OK
  branches={[]}  // âŒ ë¹ˆ ë°°ì—´! ì§€ì  ëª©ë¡ì´ ì—†ìŒ
  onFilterChange={handleFilterChange}
/>
```

#### ìˆ˜ì • í•„ìš”
```tsx
const [branches, setBranches] = useState([])

useEffect(() => {
  if (userSession.role === '0000') {
    // ì§€ì  ëª©ë¡ ì¡°íšŒ
    fetchBranches()
  }
}, [])

<ReportFilters
  showBranchFilter={userSession.role === '0000'}
  branches={branches}  // âœ… ì‹¤ì œ ë°ì´í„°
  onFilterChange={handleFilterChange}
/>
```

---

## ğŸ”§ ìˆ˜ì • ê³„íš

### ìˆ˜ì •í•  íŒŒì¼ (4ê°œ)

1. `app/reports/sales/SalesReportClient.tsx`
2. `app/reports/purchases/PurchasesReportClient.tsx`
3. `app/reports/usage/UsageReportClient.tsx`
4. `app/reports/profit/ProfitReportClient.tsx`

### ê³µí†µ íŒ¨í„´ (ê° íŒŒì¼ ë™ì¼)

```tsx
'use client'

import { useState, useEffect } from 'react'
import { createBrowserClient } from '@/lib/supabase/client'

export default function XxxReportClient({ userSession }: Props) {
  // 1. State ì¶”ê°€
  const [branches, setBranches] = useState<{id: string, name: string}[]>([])

  // 2. ì§€ì  ëª©ë¡ ì¡°íšŒ (ì‹œìŠ¤í…œ ê´€ë¦¬ìë§Œ)
  useEffect(() => {
    if (userSession.role === '0000') {
      const fetchBranches = async () => {
        const supabase = createBrowserClient()
        const { data, error } = await supabase
          .from('branches')
          .select('id, name')
          .eq('is_active', true)
          .order('name')
        
        if (!error && data) {
          setBranches(data)
        }
      }
      fetchBranches()
    }
  }, [userSession.role])

  // 3. ReportFiltersì— ì „ë‹¬
  return (
    <div>
      <ReportFilters
        initialFilter={filter}
        groupByOptions={...}
        onFilterChange={handleFilterChange}
        showBranchFilter={userSession.role === '0000'}
        branches={branches}  // âœ… ì‹¤ì œ ë°ì´í„° ì „ë‹¬
      />
    </div>
  )
}
```

---

## ğŸ“Š UI ë™ì‘

### ì‹œìŠ¤í…œ ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ì¢…í•© ë ˆí¬íŠ¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í•„í„°                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ì‹œì‘ì¼   â”‚ â”‚ ì¢…ë£Œì¼   â”‚ â”‚  ì§€ì      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â–¼        â”‚   â”‚
â”‚                          â”‚ â—‹ ì „ì²´     â”‚   â”‚ â† ì „ì²´ ì§€ì  ì„ íƒ ê°€ëŠ¥!
â”‚                          â”‚ â—‹ ê°•ë‚¨ì    â”‚   â”‚
â”‚                          â”‚ â—‹ ë¶„ë‹¹ì    â”‚   â”‚
â”‚                          â”‚ â—‹ ì„œì´ˆì    â”‚   â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ [ì¡°íšŒ]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì›ì¥/ë§¤ë‹ˆì € ë¡œê·¸ì¸ ì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ì¢…í•© ë ˆí¬íŠ¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í•„í„°                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ ì‹œì‘ì¼   â”‚ â”‚ ì¢…ë£Œì¼   â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                          â”‚
â”‚ ì§€ì : ê°•ë‚¨ì  (ê³ ì •)                      â”‚ â† ë³€ê²½ ë¶ˆê°€
â”‚                                          â”‚
â”‚ [ì¡°íšŒ]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì‹œìŠ¤í…œ ê´€ë¦¬ì - ì „ì²´ ì§€ì  ì¡°íšŒ
1. admin ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. ì¢…í•© ë ˆí¬íŠ¸ ì ‘ì†
3. ì§€ì : "ì „ì²´ ì§€ì " ì„ íƒ
4. ì¡°íšŒ ë²„íŠ¼ í´ë¦­
5. **ê²°ê³¼**: ëª¨ë“  ì§€ì  ë°ì´í„° ì§‘ê³„ âœ…

### 2. ì‹œìŠ¤í…œ ê´€ë¦¬ì - íŠ¹ì • ì§€ì  ì¡°íšŒ
1. admin ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. ì¢…í•© ë ˆí¬íŠ¸ ì ‘ì†
3. ì§€ì : "ê°•ë‚¨ì " ì„ íƒ
4. ì¡°íšŒ ë²„íŠ¼ í´ë¦­
5. **ê²°ê³¼**: ê°•ë‚¨ì  ë°ì´í„°ë§Œ ì§‘ê³„ âœ…

### 3. ì›ì¥ - ì§€ì  ì„ íƒ ë¶ˆê°€
1. ì›ì¥ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ (ê°•ë‚¨ì )
2. ì¢…í•© ë ˆí¬íŠ¸ ì ‘ì†
3. ì§€ì  ì„ íƒ í•„ë“œ: **í‘œì‹œ ì•ˆ ë¨**
4. ì¡°íšŒ ë²„íŠ¼ í´ë¦­
5. **ê²°ê³¼**: ê°•ë‚¨ì  ë°ì´í„°ë§Œ ìë™ ì¡°íšŒ âœ…

---

## ğŸ“‚ ë³€ê²½ íŒŒì¼ ìš”ì•½

### ìˆ˜ì • í•„ìš” (4ê°œ)
- `app/reports/sales/SalesReportClient.tsx`
- `app/reports/purchases/PurchasesReportClient.tsx`
- `app/reports/usage/UsageReportClient.tsx`
- `app/reports/profit/ProfitReportClient.tsx`

### ìˆ˜ì • ë¶ˆí•„ìš” (ì´ë¯¸ ì§€ì›)
- âœ… ëª¨ë“  RPC í•¨ìˆ˜
- âœ… ëª¨ë“  Server Actions
- âœ… `ReportFilters.tsx` (UIëŠ” ì´ë¯¸ ì¤€ë¹„ë¨)

---

## ğŸ¯ ì˜ˆìƒ ì½”ë“œ ë³€ê²½ëŸ‰

| íŒŒì¼ | ì¶”ê°€ ì¤„ | ìˆ˜ì • ì¤„ | ì´ ë³€ê²½ |
|------|---------|---------|---------|
| SalesReportClient.tsx | 15 | 1 | 16 |
| PurchasesReportClient.tsx | 15 | 1 | 16 |
| UsageReportClient.tsx | 15 | 1 | 16 |
| ProfitReportClient.tsx | 15 | 1 | 16 |
| **ì´ê³„** | **60** | **4** | **64ì¤„** |

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 20-30ë¶„

---

**ì‘ì„±ì¼**: 2025-01-26  
**ìƒíƒœ**: ê³„íš ìˆ˜ë¦½ ì™„ë£Œ  
**ìš°ì„ ìˆœìœ„**: ë†’ìŒ (ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥)  
**ìœ„í—˜ë„**: ë‚®ìŒ (ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ)

